<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Appointment - Pakenham Hospital</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="appointments-page">
    <!-- Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-heartbeat"></i>
                <span>Pakenham Hospital</span>
            </div>
            <ul class="nav-menu">
                <li><a href="patient-portal.html" class="nav-link"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="appointments.html" class="nav-link active"><i class="fas fa-calendar-plus"></i> Appointments</a></li>
            </ul>
            <div class="nav-actions">
                <div class="user-info" id="userInfo" style="display: none;">
                    <i class="fas fa-user-circle"></i>
                    <span id="userNameDisplay"></span>
                    <div class="user-dropdown">
                        <a href="appointments.html"><i class="fas fa-calendar"></i> My Appointments</a>
                        <a href="#profile"><i class="fas fa-user"></i> Profile</a>
                        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
                <a href="login.html" class="btn-login" id="loginBtn" style="display: none;">
                    <i class="fas fa-sign-in-alt"></i> Login
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="appointments-main">
        <div class="container">
            <!-- Header -->
            <div class="appointments-header">
                <h1><i class="fas fa-calendar-check"></i> Book Your Appointment</h1>
                <p>Schedule your visit with our healthcare professionals</p>
                <div class="appointment-steps">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <span>Patient Info</span>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <span>Select Doctor</span>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <span>Choose Time</span>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-number">4</div>
                        <span>Confirmation</span>
                    </div>
                </div>
            </div>

            <!-- Appointment Booking Wizard -->
            <div class="appointment-wizard">
                <!-- Step 1: Patient Information -->
                <div class="wizard-step active" id="step1">
                    <div class="step-header">
                        <h2><i class="fas fa-user"></i> Patient Information</h2>
                        <p>Tell us about the patient</p>
                    </div>
                    
                    <form class="appointment-form">
                        <div class="form-group">
                            <label class="radio-group">
                                <input type="radio" name="appointmentFor" value="self" checked>
                                <span class="radio-label">
                                    <i class="fas fa-user"></i>
                                    <strong>For Myself</strong>
                                    <small>I'm booking for myself</small>
                                </span>
                            </label>
                            <label class="radio-group">
                                <input type="radio" name="appointmentFor" value="other">
                                <span class="radio-label">
                                    <i class="fas fa-users"></i>
                                    <strong>For Someone Else</strong>
                                    <small>Booking for family or friend</small>
                                </span>
                            </label>
                        </div>

                        <div id="patientDetails">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firstName"><i class="fas fa-user"></i> First Name *</label>
                                    <input type="text" id="firstName" name="firstName" required>
                                </div>
                                <div class="form-group">
                                    <label for="lastName"><i class="fas fa-user"></i> Last Name *</label>
                                    <input type="text" id="lastName" name="lastName" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="dob"><i class="fas fa-birthday-cake"></i> Date of Birth *</label>
                                    <input type="date" id="dob" name="dob" required>
                                </div>
                                <div class="form-group">
                                    <label for="age"><i class="fas fa-calendar"></i> Age *</label>
                                    <input type="number" id="age" name="age" min="0" max="120" required>
                                </div>
                                <div class="form-group">
                                    <label for="gender"><i class="fas fa-venus-mars"></i> Gender *</label>
                                    <select id="gender" name="gender" required>
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="phone"><i class="fas fa-phone"></i> Phone Number *</label>
                                    <input type="tel" id="phone" name="phone" required>
                                </div>
                                <div class="form-group">
                                    <label for="email"><i class="fas fa-envelope"></i> Email Address *</label>
                                    <input type="email" id="email" name="email" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="medicalHistory"><i class="fas fa-file-medical"></i> Medical History</label>
                                <textarea id="medicalHistory" name="medicalHistory" rows="3" placeholder="Any existing conditions, allergies, or medications..."></textarea>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-next" onclick="nextStep(2)">
                                Next: Select Doctor <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Step 2: Select Doctor -->
                <div class="wizard-step" id="step2">
                    <div class="step-header">
                        <h2><i class="fas fa-user-md"></i> Select Specialist</h2>
                        <p>Choose the right doctor for your needs</p>
                    </div>

                    <div class="doctor-selection">
                        <div class="search-filter">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="doctorSearch" placeholder="Search doctors by name or specialty...">
                            </div>
                            <select id="specialtyFilter">
                                <option value="">All Specialties</option>
                                <option value="cardiology">Cardiology</option>
                                <option value="orthopedics">Orthopedics</option>
                                <option value="pediatrics">Pediatrics</option>
                                <option value="neurology">Neurology</option>
                                <option value="dermatology">Dermatology</option>
                            </select>
                        </div>

                        <div class="doctors-grid" id="doctorsGrid">
                            <!-- Doctors loaded dynamically -->
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="prevStep(1)">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button type="button" class="btn btn-next" onclick="nextStep(3)" id="nextToTime" disabled>
                            Next: Choose Time <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Choose Time -->
                <div class="wizard-step" id="step3">
                    <div class="step-header">
                        <h2><i class="fas fa-clock"></i> Select Date & Time</h2>
                        <p>Choose your preferred appointment slot</p>
                    </div>

                    <div class="time-selection">
                        <div class="selected-doctor" id="selectedDoctorInfo">
                            <!-- Selected doctor info -->
                        </div>

                        <div class="date-picker">
                            <h4>Select Date</h4>
                            <div class="calendar-nav">
                                <button class="nav-btn" onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                                <h5 id="currentMonth">March 2025</h5>
                                <button class="nav-btn" onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="calendar" id="calendar">
                                <!-- Calendar generated dynamically -->
                            </div>
                        </div>

                        <div class="time-slots" id="timeSlotsSection">
                            <h4>Available Time Slots</h4>
                            <div class="slots-container" id="timeSlots">
                                <!-- Time slots loaded dynamically -->
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="prevStep(2)">
                            <i class="fas fa-arrow-left"></i> Back to Doctors
                        </button>
                        <button type="button" class="btn btn-next" onclick="nextStep(4)" id="nextToConfirm" disabled>
                            Next: Confirm <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 4: Confirmation -->
                <div class="wizard-step" id="step4">
                    <div class="step-header">
                        <h2><i class="fas fa-check-circle"></i> Confirm Appointment</h2>
                        <p>Review and confirm your appointment details</p>
                    </div>

                    <div class="confirmation-summary">
                        <div class="summary-card">
                            <div class="summary-section">
                                <h4><i class="fas fa-user"></i> Patient Details</h4>
                                <div id="summaryPatient"></div>
                            </div>
                            <div class="summary-section">
                                <h4><i class="fas fa-user-md"></i> Doctor & Service</h4>
                                <div id="summaryDoctor"></div>
                            </div>
                            <div class="summary-section">
                                <h4><i class="fas fa-calendar"></i> Appointment Time</h4>
                                <div id="summaryTime"></div>
                            </div>
                            <div class="summary-section">
                                <h4><i class="fas fa-stethoscope"></i> Reason for Visit</h4>
                                <div class="form-group">
                                    <label for="appointmentReason">Please describe your symptoms or reason for visit *</label>
                                    <textarea id="appointmentReason" rows="3" required></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="consent-section">
                            <label class="checkbox-container">
                                <input type="checkbox" id="consentAgreement" required>
                                <span class="checkmark"></span>
                                I agree to the <a href="#">terms and conditions</a> and confirm that all information provided is accurate
                            </label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="prevStep(3)">
                            <i class="fas fa-arrow-left"></i> Back to Time
                        </button>
                        <button type="button" class="btn btn-success" onclick="confirmAppointment()" id="confirmBtn">
                            <i class="fas fa-calendar-plus"></i> Confirm Appointment
                        </button>
                    </div>
                </div>
            </div>

            <!-- My Appointments Section -->
            <section class="my-appointments" id="myAppointmentsSection">
                <div class="section-header">
                    <h2><i class="fas fa-list-alt"></i> My Appointments</h2>
                    <p>Your scheduled and past appointments</p>
                </div>

                <div class="appointments-tabs">
                    <button class="tab-btn active" onclick="switchTab('upcoming')">Upcoming</button>
                    <button class="tab-btn" onclick="switchTab('completed')">Completed</button>
                    <button class="tab-btn" onclick="switchTab('cancelled')">Cancelled</button>
                </div>

                <div class="appointments-list">
                    <div class="tab-content active" id="upcomingTab">
                        <!-- Upcoming appointments -->
                    </div>
                    <div class="tab-content" id="completedTab">
                        <!-- Completed appointments -->
                    </div>
                    <div class="tab-content" id="cancelledTab">
                        <!-- Cancelled appointments -->
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <p>Loading available slots...</p>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content success-modal">
            <div class="modal-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3>Appointment Booked Successfully!</h3>
            <div id="appointmentDetails"></div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="closeSuccessModal()">
                    <i class="fas fa-calendar"></i> View My Appointments
                </button>
                <button class="btn btn-outline" onclick="bookAnother()">
                    <i class="fas fa-plus"></i> Book Another
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Sample Data
        const doctors = [
            {
                id: 1,
                name: "Dr. Emily Carter",
                specialty: "Cardiology",
                experience: "15 years",
                rating: 4.9,
                available: true,
                description: "Expert in heart diseases and cardiovascular treatments. Specializes in angioplasty and cardiac rehabilitation.",
                image: "fas fa-user-md",
                schedule: {
                    monday: ["09:00", "10:00", "11:00", "14:00", "15:00"],
                    tuesday: ["09:00", "10:00", "14:00", "15:00"],
                    wednesday: ["10:00", "11:00", "14:00", "16:00"],
                    thursday: ["09:00", "11:00", "14:00", "15:00"],
                    friday: ["09:00", "10:00", "14:00"]
                }
            },
            {
                id: 2,
                name: "Dr. Michael Chen",
                specialty: "Orthopedics",
                experience: "12 years",
                rating: 4.8,
                available: true,
                description: "Specialist in joint replacement and sports injuries. Performs minimally invasive surgeries.",
                image: "fas fa-user-md",
                schedule: {
                    monday: ["10:00", "11:00", "14:00", "15:00"],
                    tuesday: ["09:00", "10:00", "14:00", "16:00"],
                    thursday: ["09:00", "11:00", "14:00", "15:00"],
                    friday: ["09:00", "10:00", "14:00", "15:00"]
                }
            },
            {
                id: 3,
                name: "Dr. Sarah Johnson",
                specialty: "Pediatrics",
                experience: "10 years",
                rating: 4.9,
                available: true,
                description: "Expert in child healthcare, vaccinations, and developmental disorders. Gentle and caring approach.",
                image: "fas fa-user-md",
                schedule: {
                    monday: ["09:00", "10:00", "11:00"],
                    tuesday: ["09:00", "10:00", "14:00", "15:00"],
                    wednesday: ["10:00", "11:00", "14:00"],
                    friday: ["09:00", "10:00", "14:00", "15:00"]
                }
            }
        ];

        let currentStep = 1;
        let selectedDoctor = null;
        let selectedDate = null;
        let selectedTime = null;
        let userAppointments = JSON.parse(localStorage.getItem('userAppointments')) || [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
            initializeDoctors();
            initializeCalendar();
            loadUserAppointments();
            setupEventListeners();
        });

        function checkAuthentication() {
            if (!sessionStorage.getItem('isUser')) {
                alert('Please login to book an appointment.');
                window.location.href = 'login.html';
                return;
            }

            const userInfo = document.getElementById('userInfo');
            const loginBtn = document.getElementById('loginBtn');
            if (sessionStorage.getItem('isUser')) {
                userInfo.style.display = 'flex';
                loginBtn.style.display = 'none';
                document.getElementById('userNameDisplay').textContent = sessionStorage.getItem('userName');
                
                // Pre-fill user data if available
                prefillUserData();
            }
        }

        function prefillUserData() {
            // In a real app, this would come from user profile
            document.getElementById('firstName').value = sessionStorage.getItem('userName')?.split(' ')[0] || '';
            document.getElementById('lastName').value = sessionStorage.getItem('userName')?.split(' ')[1] || '';
            document.getElementById('email').value = 'patient@demo.com';
            document.getElementById('phone').value = '0412 345 678';
        }

        function initializeDoctors() {
            const grid = document.getElementById('doctorsGrid');
            grid.innerHTML = doctors.map(doctor => `
                <div class="doctor-card" data-id="${doctor.id}" onclick="selectDoctor(${doctor.id})">
                    <div class="doctor-avatar">
                        <i class="${doctor.image}"></i>
                    </div>
                    <div class="doctor-info">
                        <h3>${doctor.name}</h3>
                        <span class="specialty">${doctor.specialty}</span>
                        <div class="doctor-meta">
                            <span class="experience"><i class="fas fa-briefcase"></i> ${doctor.experience}</span>
                            <span class="rating"><i class="fas fa-star"></i> ${doctor.rating}</span>
                        </div>
                        <p class="description">${doctor.description}</p>
                    </div>
                    <div class="availability ${doctor.available ? 'available' : 'unavailable'}">
                        ${doctor.available ? '<i class="fas fa-check"></i> Available' : '<i class="fas fa-times"></i> Unavailable'}
                    </div>
                </div>
            `).join('');
        }

        function selectDoctor(doctorId) {
            selectedDoctor = doctors.find(d => d.id === doctorId);
            
            // Update UI
            document.querySelectorAll('.doctor-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`.doctor-card[data-id="${doctorId}"]`).classList.add('selected');
            
            // Enable next button
            document.getElementById('nextToTime').disabled = false;
            
            // Update selected doctor info for next step
            updateSelectedDoctorInfo();
        }

        function updateSelectedDoctorInfo() {
            const infoDiv = document.getElementById('selectedDoctorInfo');
            infoDiv.innerHTML = `
                <div class="doctor-summary">
                    <div class="doctor-avatar">
                        <i class="${selectedDoctor.image}"></i>
                    </div>
                    <div class="doctor-details">
                        <h4>${selectedDoctor.name}</h4>
                        <span class="specialty">${selectedDoctor.specialty}</span>
                        <span class="experience">${selectedDoctor.experience} experience</span>
                    </div>
                </div>
            `;
        }

        function initializeCalendar() {
            const now = new Date();
            renderCalendar(now.getFullYear(), now.getMonth());
        }

        function renderCalendar(year, month) {
            const calendarDiv = document.getElementById('calendar');
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            let calendarHTML = '<div class="calendar-header">';
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                calendarHTML += `<div class="calendar-day-header">${day}</div>`;
            });
            calendarHTML += '</div><div class="calendar-days">';
            
            // Empty cells for days before the first day of the month
            for (let i = 0; i < firstDay.getDay(); i++) {
                calendarHTML += '<div class="calendar-day empty"></div>';
            }
            
            // Days of the month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const isToday = date.toDateString() === today.toDateString();
                const isPast = date < today && !isToday;
                const dayClass = `calendar-day ${isToday ? 'today' : ''} ${isPast ? 'past' : 'future'}`;
                
                calendarHTML += `
                    <div class="${dayClass}" data-date="${date.toISOString().split('T')[0]}" 
                         onclick="${isPast ? '' : `selectDate('${date.toISOString().split('T')[0]}')`}">
                        ${day}
                    </div>
                `;
            }
            
            calendarHTML += '</div>';
            calendarDiv.innerHTML = calendarHTML;
        }

        function changeMonth(direction) {
            const currentMonth = document.getElementById('currentMonth').textContent;
            const [monthName, year] = currentMonth.split(' ');
            const monthIndex = new Date(`${monthName} 1, ${year}`).getMonth();
            const newDate = new Date(year, monthIndex + direction, 1);
            renderCalendar(newDate.getFullYear(), newDate.getMonth());
        }

        function selectDate(dateString) {
            selectedDate = dateString;
            
            // Update UI
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected');
            });
            document.querySelector(`.calendar-day[data-date="${dateString}"]`).classList.add('selected');
            
            // Load available time slots
            loadTimeSlots(dateString);
        }

        function loadTimeSlots(dateString) {
            const date = new Date(dateString);
            const dayName = date.toLocaleDateString('en-US', { weekday: 'long' }).toLowerCase();
            const slots = selectedDoctor.schedule[dayName] || [];
            
            const slotsContainer = document.getElementById('timeSlots');
            if (slots.length === 0) {
                slotsContainer.innerHTML = '<div class="no-slots">No available slots for this date</div>';
                document.getElementById('nextToConfirm').disabled = true;
                return;
            }
            
            slotsContainer.innerHTML = slots.map(slot => `
                <div class="time-slot" onclick="selectTimeSlot('${slot}')">
                    <i class="fas fa-clock"></i>
                    <span>${slot}</span>
                </div>
            `).join('');
        }

        function selectTimeSlot(time) {
            selectedTime = time;
            
            // Update UI
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Enable confirm button
            document.getElementById('nextToConfirm').disabled = false;
            
            // Update summary
            updateAppointmentSummary();
        }

        function updateAppointmentSummary() {
            document.getElementById('summaryPatient').innerHTML = `
                <p><strong>Name:</strong> ${document.getElementById('firstName').value} ${document.getElementById('lastName').value}</p>
                <p><strong>Age:</strong> ${document.getElementById('age').value} years</p>
                <p><strong>Contact:</strong> ${document.getElementById('phone').value}</p>
            `;
            
            document.getElementById('summaryDoctor').innerHTML = `
                <p><strong>Doctor:</strong> ${selectedDoctor.name}</p>
                <p><strong>Specialty:</strong> ${selectedDoctor.specialty}</p>
                <p><strong>Experience:</strong> ${selectedDoctor.experience}</p>
            `;
            
            const appointmentDate = new Date(selectedDate).toLocaleDateString('en-AU', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('summaryTime').innerHTML = `
                <p><strong>Date:</strong> ${appointmentDate}</p>
                <p><strong>Time:</strong> ${selectedTime}</p>
                <p><strong>Duration:</strong> 30 minutes</p>
            `;
        }

        function nextStep(step) {
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.getElementById(`step${step}`).classList.add('active');
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
            document.querySelector(`.step[data-step="${step}"]`).classList.add('active');
            currentStep = step;
        }

        function prevStep(step) {
            nextStep(step);
        }

        function confirmAppointment() {
            if (!document.getElementById('consentAgreement').checked) {
                alert('Please agree to the terms and conditions.');
                return;
            }

            if (!document.getElementById('appointmentReason').value) {
                alert('Please describe your reason for visit.');
                return;
            }

            const appointment = {
                id: 'APT' + Date.now(),
                patientName: `${document.getElementById('firstName').value} ${document.getElementById('lastName').value}`,
                doctor: selectedDoctor.name,
                specialty: selectedDoctor.specialty,
                date: selectedDate,
                time: selectedTime,
                reason: document.getElementById('appointmentReason').value,
                status: 'confirmed',
                bookedAt: new Date().toISOString(),
                age: document.getElementById('age').value,
                gender: document.getElementById('gender').value
            };

            userAppointments.push(appointment);
            localStorage.setItem('userAppointments', JSON.stringify(userAppointments));

            showSuccessModal(appointment);
        }

        function showSuccessModal(appointment) {
            const modal = document.getElementById('successModal');
            const details = document.getElementById('appointmentDetails');
            
            const appointmentDate = new Date(appointment.date).toLocaleDateString('en-AU', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            details.innerHTML = `
                <div class="appointment-success">
                    <p><strong>Appointment ID:</strong> ${appointment.id}</p>
                    <p><strong>Patient:</strong> ${appointment.patientName}</p>
                    <p><strong>Doctor:</strong> ${appointment.doctor}</p>
                    <p><strong>Date & Time:</strong> ${appointmentDate} at ${appointment.time}</p>
                    <p><strong>Reason:</strong> ${appointment.reason}</p>
                </div>
                <div class="success-notes">
                    <p><i class="fas fa-info-circle"></i> You will receive a confirmation email shortly.</p>
                    <p><i class="fas fa-clock"></i> Please arrive 15 minutes before your appointment.</p>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function closeSuccessModal() {
            document.getElementById('successModal').style.display = 'none';
            loadUserAppointments();
            resetWizard();
        }

        function bookAnother() {
            document.getElementById('successModal').style.display = 'none';
            resetWizard();
        }

        function resetWizard() {
            currentStep = 1;
            selectedDoctor = null;
            selectedDate = null;
            selectedTime = null;
            
            // Reset steps
            document.querySelectorAll('.wizard-step').forEach(step => step.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.querySelector('.step[data-step="1"]').classList.add('active');
            
            // Reset form
            document.getElementById('appointmentForm').reset();
        }

        function loadUserAppointments() {
            const upcomingTab = document.getElementById('upcomingTab');
            const completedTab = document.getElementById('completedTab');
            const cancelledTab = document.getElementById('cancelledTab');
            
            const upcoming = userAppointments.filter(apt => apt.status === 'confirmed');
            const completed = userAppointments.filter(apt => apt.status === 'completed');
            const cancelled = userAppointments.filter(apt => apt.status === 'cancelled');
            
            upcomingTab.innerHTML = renderAppointmentsList(upcoming, 'upcoming');
            completedTab.innerHTML = renderAppointmentsList(completed, 'completed');
            cancelledTab.innerHTML = renderAppointmentsList(cancelled, 'cancelled');
        }

        function renderAppointmentsList(appointments, type) {
            if (appointments.length === 0) {
                return `<div class="empty-state">
                    <i class="fas fa-calendar-times"></i>
                    <h3>No ${type} appointments</h3>
                    <p>You don't have any ${type} appointments yet.</p>
                    ${type === 'upcoming' ? '<button class="btn btn-primary" onclick="resetWizard()">Book an Appointment</button>' : ''}
                </div>`;
            }
            
            return appointments.map(apt => `
                <div class="appointment-item ${type}">
                    <div class="appointment-header">
                        <div class="appointment-info">
                            <h4>${apt.doctor} - ${apt.specialty}</h4>
                            <p>Appointment ID: ${apt.id}</p>
                        </div>
                        <span class="appointment-status ${apt.status}">${apt.status}</span>
                    </div>
                    <div class="appointment-details">
                        <p><i class="fas fa-user"></i> ${apt.patientName} (Age: ${apt.age})</p>
                        <p><i class="fas fa-calendar"></i> ${new Date(apt.date).toLocaleDateString('en-AU')} at ${apt.time}</p>
                        <p><i class="fas fa-stethoscope"></i> ${apt.reason}</p>
                    </div>
                    <div class="appointment-actions">
                        ${type === 'upcoming' ? `
                            <button class="btn btn-outline" onclick="cancelAppointment('${apt.id}')">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                            <button class="btn btn-primary" onclick="rescheduleAppointment('${apt.id}')">
                                <i class="fas fa-edit"></i> Reschedule
                            </button>
                        ` : ''}
                        <button class="btn btn-secondary" onclick="viewAppointmentDetails('${apt.id}')">
                            <i class="fas fa-eye"></i> Details
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function cancelAppointment(appointmentId) {
            if (confirm('Are you sure you want to cancel this appointment?')) {
                const appointment = userAppointments.find(apt => apt.id === appointmentId);
                if (appointment) {
                    appointment.status = 'cancelled';
                    localStorage.setItem('userAppointments', JSON.stringify(userAppointments));
                    loadUserAppointments();
                    alert('Appointment cancelled successfully.');
                }
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.currentTarget.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function setupEventListeners() {
            // Real-time age calculation from DOB
            document.getElementById('dob').addEventListener('change', function() {
                const dob = new Date(this.value);
                const today = new Date();
                const age = Math.floor((today - dob) / (365.25 * 24 * 60 * 60 * 1000));
                document.getElementById('age').value = age;
            });

            // Doctor search
            document.getElementById('doctorSearch').addEventListener('input', filterDoctors);
            document.getElementById('specialtyFilter').addEventListener('change', filterDoctors);
        }

        function filterDoctors() {
            const searchTerm = document.getElementById('doctorSearch').value.toLowerCase();
            const specialty = document.getElementById('specialtyFilter').value;
            
            const filteredDoctors = doctors.filter(doctor => {
                const matchesSearch = doctor.name.toLowerCase().includes(searchTerm) || 
                                    doctor.specialty.toLowerCase().includes(searchTerm);
                const matchesSpecialty = !specialty || doctor.specialty.toLowerCase() === specialty;
                return matchesSearch && matchesSpecialty;
            });
            
            const grid = document.getElementById('doctorsGrid');
            grid.innerHTML = filteredDoctors.map(doctor => `
                <div class="doctor-card" data-id="${doctor.id}" onclick="selectDoctor(${doctor.id})">
                    <div class="doctor-avatar">
                        <i class="${doctor.image}"></i>
                    </div>
                    <div class="doctor-info">
                        <h3>${doctor.name}</h3>
                        <span class="specialty">${doctor.specialty}</span>
                        <div class="doctor-meta">
                            <span class="experience"><i class="fas fa-briefcase"></i> ${doctor.experience}</span>
                            <span class="rating"><i class="fas fa-star"></i> ${doctor.rating}</span>
                        </div>
                        <p class="description">${doctor.description}</p>
                    </div>
                    <div class="availability ${doctor.available ? 'available' : 'unavailable'}">
                        ${doctor.available ? '<i class="fas fa-check"></i> Available' : '<i class="fas fa-times"></i> Unavailable'}
                    </div>
                </div>
            `).join('');
        }

        function logout() {
            sessionStorage.removeItem('isUser');
            sessionStorage.removeItem('userName');
            window.location.href = 'patient-portal.html';
        }
    </script>
</body>
</html>